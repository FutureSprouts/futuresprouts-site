<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex, nofollow">
  <title>Analytics | FutureSprouts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Analytics dashboard (local)." />
  <link rel="stylesheet" href="style.css" />
  <script src="config.js"></script>
</head>
<body>

  <!-- Injected header (from script.js) -->
  <div id="siteHeader"></div>

  <section class="section">
    <div class="container">
      <div class="kicker reveal">Analytics</div>
      <h2 class="reveal">Dashboard (local)</h2>
      <p class="reveal small">
        Placeholder analytics stored in your browser. Later you can migrate to GA4 / Plausible.
      </p>

      <div class="grid cols-3" style="margin-top:14px;">
        <div class="card reveal">
          <div class="pill">Page Views</div>
          <h2 id="pv">0</h2>
          <p class="small">Total page_view events</p>
        </div>
        <div class="card reveal">
          <div class="pill">Cart Updates</div>
          <h2 id="cu">0</h2>
          <p class="small">cart_update / cart_remove</p>
        </div>
        <div class="card reveal">
          <div class="pill">Requests</div>
          <h2 id="rs">0</h2>
          <p class="small">Submit attempts / successes</p>
        </div>
      </div>

      <div class="card reveal" style="margin-top:14px;">
        <h3>Recent activity</h3>
        <p class="small">Last 50 events.</p>
        <div style="overflow:auto; margin-top:10px;">
          <table class="table">
            <thead>
              <tr><th>Time</th><th>Type</th><th>Data</th></tr>
            </thead>
            <tbody id="events"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- Injected footer (from script.js) -->
  <div id="siteFooter"></div>

  <script src="script.js"></script>
  <script>
    // Escape HTML so analytics data can't break your layout
    function esc(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    const store = JSON.parse(localStorage.getItem("fs_analytics_v1") || '{"events":[]}');
    const ev = store.events || [];

    const pv = ev.filter(x => x.type === "page_view").length;
    const cu = ev.filter(x => x.type === "cart_update" || x.type === "cart_remove" || x.type === "cart_meta_update").length;
    const submit = ev.filter(x => x.type === "order_submit_attempt").length;
    const success = ev.filter(x => x.type === "order_submit_success").length;

    document.getElementById("pv").textContent = pv;
    document.getElementById("cu").textContent = cu;
    document.getElementById("rs").textContent = `${success} / ${submit}`;

    const tbody = document.getElementById("events");
    const last = ev.slice(-50).reverse();

    tbody.innerHTML = last.map(e => {
      const ts = (e.ts || "").replace("T"," ").slice(0,19);
      const data = esc(JSON.stringify(e.data || {}, null, 0));
      return `
        <tr>
          <td>${esc(ts)}</td>
          <td><strong>${esc(e.type || "")}</strong></td>
          <td class="small"><pre style="margin:0; white-space:pre-wrap;">${data}</pre></td>
        </tr>
      `;
    }).join("");
  </script>

</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Services | FutureSprouts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Request seed packets, garden beds, and soil testing kits from FutureSprouts." />
  <link rel="stylesheet" href="style.css" />
  <script src="config.js"></script>
</head>
<body>

  <!-- Injected header (from script.js) -->
  <div id="siteHeader"></div>

  <section class="section">
    <div class="container">
      <div class="kicker reveal">Services</div>
      <h2 class="reveal">Request supplies for your school or community.</h2>
      <p class="reveal">Choose a package below and add what you need to your cart.</p>

      <div class="grid cols-3">

        <!-- Seeds -->
        <a class="card shop-card reveal" href="seed-packets.html" id="svcSeeds">
          <img class="shop-img" src="https://images.unsplash.com/photo-1524593119773-28476c2c1d8f?auto=format&fit=crop&w=1600&q=80" alt="Seed packets">
          <div class="shop-body">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
              <div class="pill">Seeds</div>
              <span class="badge ok" id="badgeSeeds">Available</span>
            </div>
            <h3 style="margin-top:10px;">Seed Packets</h3>
            <p class="small" id="subSeeds">Choose seed types and request brochures + packets.</p>
          </div>
        </a>

        <!-- Beds -->
        <a class="card shop-card reveal" href="garden-beds.html" id="svcBeds">
          <img class="shop-img" src="https://images.unsplash.com/photo-1598114801319-6f1aa4aefe72?auto=format&fit=crop&w=1600&q=80" alt="Garden bed">
          <div class="shop-body">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
              <div class="pill">Beds</div>
              <span class="badge ok" id="badgeBeds">Available</span>
            </div>
            <h3 style="margin-top:10px;">Garden Beds</h3>
            <p class="small" id="subBeds">Request 2×4 or 4×4 beds (max 4 total per order).</p>
          </div>
        </a>

        <!-- Soil -->
        <a class="card shop-card reveal" href="soil-kits.html" id="svcSoil">
          <img class="shop-img" src="https://images.unsplash.com/photo-1617137984095-74e4e5b984b3?auto=format&fit=crop&w=1600&q=80" alt="Soil testing">
          <div class="shop-body">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
              <div class="pill">Soil</div>
              <span class="badge ok" id="badgeSoil">Available</span>
            </div>
            <h3 style="margin-top:10px;">Soil Testing Kit</h3>
            <p class="small" id="subSoil">One kit per order to prevent abuse.</p>
          </div>
        </a>

      </div>

      <div class="notice reveal">
        You can view your cart any time using the “Cart” button in the top-right.
      </div>

      <div class="card reveal" style="margin-top:14px;">
        <h3 style="margin-top:0;">Availability notes</h3>
        <p class="small" style="margin-bottom:0;">
          Availability updates automatically based on your <strong>Admin → Inventory</strong> settings.
          If an item shows <strong>Out of stock</strong>, it will be temporarily disabled.
        </p>
      </div>
    </div>
  </section>

  <!-- Injected footer (from script.js) -->
  <div id="siteFooter"></div>

  <script src="script.js"></script>

  <script>
    // Services availability logic (uses inventory from script.js)
    (function () {
      function run() {
        if (!window.FS_CART || !window.FS_CART.loadInventory) return;

        function groupStatus(keys) {
          const inv = window.FS_CART.loadInventory();
          const items = (inv && inv.items) || {};

          let anyAvailable = false;
          let anyLimited = false;
          let bestRemaining = null;

          keys.forEach(k => {
            const it = items[k] || { available: true, remaining: 999 };
            const available = !!it.available && (it.remaining == null || it.remaining > 0);

            if (available) anyAvailable = true;
            if (available && it.remaining != null && it.remaining <= 10) anyLimited = true;

            if (available && it.remaining != null) {
              bestRemaining = (bestRemaining == null) ? it.remaining : Math.min(bestRemaining, it.remaining);
            }
          });

          if (!anyAvailable) return { label: "Out of stock", tone: "danger", remaining: 0 };
          if (anyLimited) return { label: "Limited", tone: "warn", remaining: bestRemaining };
          return { label: "Available", tone: "ok", remaining: bestRemaining };
        }

        function setCardStatus(cardId, badgeId, subId, status) {
          const card = document.getElementById(cardId);
          const badge = document.getElementById(badgeId);
          const sub = document.getElementById(subId);
          if (!card || !badge) return;

          badge.textContent = status.label;
          badge.classList.remove("ok", "warn", "danger");
          badge.classList.add(status.tone);

          if (sub) {
            const base = sub.getAttribute("data-base") || sub.textContent;
            sub.setAttribute("data-base", base);
            if (status.label === "Limited" && typeof status.remaining === "number") {
              sub.textContent = base + ` • Remaining: ${status.remaining}`;
            } else {
              sub.textContent = base;
            }
          }

          const out = status.label === "Out of stock";
          if (out) {
            card.setAttribute("aria-disabled", "true");
            card.style.opacity = "0.55";
            card.style.pointerEvents = "none";
          } else {
            card.removeAttribute("aria-disabled");
            card.style.opacity = "";
            card.style.pointerEvents = "";
          }
        }

        const seeds = groupStatus(["seed-tomato", "seed-corn", "seed-multi"]);
        const beds  = groupStatus(["bed-2x4", "bed-4x4"]);
        const soil  = groupStatus(["soil-kit-1"]);

        setCardStatus("svcSeeds", "badgeSeeds", "subSeeds", seeds);
        setCardStatus("svcBeds", "badgeBeds", "subBeds", beds);
        setCardStatus("svcSoil", "badgeSoil", "subSoil", soil);
      }

      // Run now, and also once after DOM is fully ready (safe for slow loads)
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", run);
      } else {
        run();
      }
    })();
  </script>

</body>
</html>
